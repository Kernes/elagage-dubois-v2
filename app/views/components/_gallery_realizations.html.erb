<%# 
  Composant pour afficher la galerie de réalisations avec modal
  
  Paramètres:
  - realizations: Array de hash avec { category: "Nom", images: [{ url: "...", alt: "..." }] }
  - description: String - Description de la section
%>
<% realizations ||= [] %>
<% description ||= "Découvrez nos réalisations" %>

<!-- Galerie de réalisations -->
<section class="py-24 bg-gradient-to-b from-white to-green-50">
  <div class="px-6 mx-auto max-w-7xl lg:px-8">
    <div class="mx-auto mb-16 max-w-2xl text-center">
      <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Nos Réalisations en Images</h2>
      <p class="mt-4 text-lg text-gray-600"><%= description %></p>
      <p class="mt-2 text-sm text-gray-500">Cliquez sur une réalisation pour découvrir plus de photos</p>
    </div>
    
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3" id="gallery-container">
      <% realizations.each do |realization| %>
        <% realization[:images].each_with_index do |image, index| %>
          <div class="overflow-hidden relative rounded-2xl shadow-xl aspect-[4/3] group cursor-pointer gallery-item <%= 'hidden' unless index == 0 %>" 
               data-category="<%= realization[:category] %>" 
               data-image-index="<%= index %>">
            <% if image[:url]&.include?('unsplash.com') %>
              <% srcset_data = unsplash_srcset(image[:url], { mobile: 400, tablet: 800, desktop: 1920 }) %>
              <% 
                # Générer l'URL haute résolution pour la modal
                base_url = image[:url].split('?').first
                params = image[:url].include?('?') ? image[:url].split('?').last.split('&').reject { |p| p.start_with?('w=') } : []
                params_str = params.any? ? "&#{params.join('&')}" : ""
                high_res_url = "#{base_url}?w=1920#{params_str}"
              %>
              <img src="<%= srcset_data[:src] %>" 
                   srcset="<%= srcset_data[:srcset] %>"
                   sizes="(max-width: 640px) 400px, (max-width: 1024px) 800px, 1920px"
                   alt="<%= image[:alt] %>" 
                   class="object-cover w-full h-full transition-transform group-hover:scale-110"
                   loading="lazy"
                   data-full-url="<%= high_res_url %>">
            <% else %>
              <img src="<%= image[:url] %>" 
                   alt="<%= image[:alt] %>" 
                   class="object-cover w-full h-full transition-transform group-hover:scale-110"
                   loading="lazy"
                   data-full-url="<%= image[:url] %>">
            <% end %>
            <div class="absolute inset-0 bg-gradient-to-t to-transparent from-black/60"></div>
            <div class="absolute right-4 bottom-4 left-4">
              <p class="font-semibold text-white"><%= realization[:category] %></p>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<!-- Modal pour la galerie d'images -->
<div id="image-modal" class="hidden fixed inset-0 z-50 backdrop-blur-sm bg-black/95">
  <div class="flex relative justify-center items-center p-4 w-full h-full" id="modal-backdrop">
    <!-- Conteneur de l'image -->
    <div id="image-container" class="flex relative justify-center items-center w-full max-w-7xl h-full">
      <!-- Wrapper autour de l'image pour positionner les boutons -->
      <div id="image-wrapper" class="flex relative justify-center items-center modal-image-wrapper">
        <div id="image-inner-wrapper" class="relative modal-image-inner">
          <img id="modal-image" src="" alt="" class="object-cover modal-image" style="width: 100%; height: 100%; display: block;">
          
          <!-- Bouton de fermeture (sur l'image, en haut à droite) -->
          <button id="modal-close" class="absolute top-2 right-2 z-30 p-2.5 text-white rounded-full shadow-xl transition-all bg-black/80 hover:bg-black hover:scale-110" aria-label="Fermer la modal">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          
          <!-- Bouton précédent (sur l'image, à gauche) -->
          <button id="modal-prev" class="absolute left-2 top-1/2 z-30 p-2.5 text-white rounded-full shadow-xl transition-all -translate-y-1/2 bg-black/80 hover:bg-black hover:scale-110" aria-label="Image précédente">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          
          <!-- Bouton suivant (sur l'image, à droite) -->
          <button id="modal-next" class="absolute right-2 top-1/2 z-30 p-2.5 text-white rounded-full shadow-xl transition-all -translate-y-1/2 bg-black/80 hover:bg-black hover:scale-110" aria-label="Image suivante">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Titre de la catégorie (sera centré dynamiquement avec l'image) -->
    <div id="modal-title-container" class="absolute bottom-4 px-6 py-3 rounded-lg backdrop-blur-sm pointer-events-none bg-black/50">
      <p id="modal-category" class="text-lg font-semibold text-center text-white"></p>
      <p id="modal-counter" class="mt-1 text-sm text-center text-gray-300"></p>
    </div>
  </div>
</div>

<%= javascript_import_module_tag "gallery_modal" %>

