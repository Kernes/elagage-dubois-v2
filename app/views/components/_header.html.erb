<header class="fixed inset-x-0 top-0 z-[100] bg-white/95 backdrop-blur-sm shadow-sm">
  <nav aria-label="Global" class="flex justify-between items-center p-4 mx-auto max-w-7xl lg:px-8">
    <div class="flex lg:flex-1">
      <a href="/" class="p-1.5 -m-1.5">
        <span class="sr-only">Élagage Dubois</span>
        <div class="text-2xl font-bold text-green-800">ÉLAGAGE DUBOIS</div>
      </a>
    </div>
    <div class="flex lg:hidden">
      <button type="button" id="mobile-menu-button" class="inline-flex justify-center items-center p-2.5 -m-2.5 text-gray-700 rounded-md">
        <span class="sr-only">Ouvrir le menu</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-6 h-6">
          <path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </div>
    <div class="hidden lg:flex lg:gap-x-8 lg:items-center">
      <a href="<%= elagage_path %>" class="text-sm font-semibold text-gray-900 transition-colors hover:text-green-700">Élagage</a>
      <a href="<%= abattage_path %>" class="text-sm font-semibold text-gray-900 transition-colors hover:text-green-700">Abattage</a>
      <a href="<%= dessouchage_path %>" class="text-sm font-semibold text-gray-900 transition-colors hover:text-green-700">Dessouchage</a>
      <a href="<%= entretien_path %>" class="text-sm font-semibold text-gray-900 transition-colors hover:text-green-700">Entretien</a>
      <a href="tel:+33620479966" class="px-4 py-2 text-sm font-semibold text-white bg-green-700 rounded-md transition-colors hover:bg-green-800">06 20 47 99 66</a>
      <a href="/devis" class="px-4 py-2 text-sm font-semibold text-white bg-amber-700 rounded-md transition-colors hover:bg-amber-800">Devis gratuit</a>
    </div>
  </nav>
</header>

<!-- Menu mobile (en dehors du header pour un z-index indépendant) -->
<div id="mobile-menu" class="hidden lg:hidden fixed inset-0 z-[9999] bg-white">
  <div class="flex flex-col h-full">
    <div class="flex justify-between items-center p-4 border-b">
      <span class="text-xl font-bold text-green-800">ÉLAGAGE DUBOIS</span>
      <button type="button" id="mobile-menu-close" class="p-2 text-gray-700">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-6 h-6">
          <path d="M6 18 18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </div>
    <div class="overflow-y-auto flex-1 p-4 space-y-4">
      <a href="<%= elagage_path %>" class="block py-2 font-semibold text-gray-900 hover:text-green-700">Élagage</a>
      <a href="<%= abattage_path %>" class="block py-2 font-semibold text-gray-900 hover:text-green-700">Abattage</a>
      <a href="<%= dessouchage_path %>" class="block py-2 font-semibold text-gray-900 hover:text-green-700">Dessouchage</a>
      <a href="<%= entretien_path %>" class="block py-2 font-semibold text-gray-900 hover:text-green-700">Entretien</a>
      <div class="pt-4 space-y-3 border-t">
        <a href="tel:+33620479966" class="block px-4 py-3 font-semibold text-center text-white bg-green-700 rounded-md hover:bg-green-800">06 20 47 99 66</a>
        <a href="/devis" class="block px-4 py-3 font-semibold text-center text-white bg-amber-700 rounded-md hover:bg-amber-800">Devis gratuit</a>
      </div>
    </div>
  </div>
</div>

<script>
  // Fonction pour initialiser le menu mobile
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const menuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');

    if (!menuButton || !menuClose || !mobileMenu) return;

    // Retirer les anciens event listeners en clonant les éléments
    const newMenuButton = menuButton.cloneNode(true);
    const newMenuClose = menuClose.cloneNode(true);
    menuButton.parentNode.replaceChild(newMenuButton, menuButton);
    menuClose.parentNode.replaceChild(newMenuClose, menuClose);

    // Ajouter les nouveaux event listeners
    newMenuButton.addEventListener('click', function() {
      mobileMenu.classList.remove('hidden');
    });

    newMenuClose.addEventListener('click', function() {
      mobileMenu.classList.add('hidden');
    });

    // Fermer le menu en cliquant sur un lien
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', function() {
        mobileMenu.classList.add('hidden');
      });
    });
  }

  // Initialiser au chargement de la page
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }

  // Réinitialiser lors de la navigation Turbo
  document.addEventListener('turbo:load', initMobileMenu);
  document.addEventListener('turbo:frame-load', initMobileMenu);
</script>
